<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイピングゲーム</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <h1>タイピングゲーム</h1>
        <button id="settings-button" class="control-button">⚙️</button>
    </header>

    <div class="game-container">
        <div class="score-display">
            <div class="info">打鍵数: <span id="keystrokes">0</span> 回</div>
            <div class="info">文字数: <span id="characters">0</span> 文字</div>
            <div class="info">ミス: <span id="miss">0</span> 回</div>
            <div class="info">正誤率: <span id="accuracy">100.0</span> %</div>
            <div class="info">打鍵速度: <span id="typingSpeed">0.00</span> 打/秒</div>
            <div class="info">残り時間: <span id="time-left-display">--</span> 秒</div>
        </div>

        <div class="target-word-area">
            <div id="targetKanji" class="target-text"></div>
            <div id="targetKana" class="target-text"></div>
            <div id="targetRomaji" class="target-text"></div>
        </div>
    </div>

    <div id="postGameControls" style="margin-top: 10px; text-align: center;">
        <button id="showResultButton" class="small-button" style="display:none;">結果を再表示</button>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="modal-close-button">&times;</span>
            <h2>ゲーム終了！</h2>
            <div class="result-table-container">
                <table class="result-table">
                    <tbody>
                        <tr>
                            <th>打鍵数</th>
                            <td><span id="finalKeystrokes">0</span> 回</td>
                        </tr>
                        <tr>
                            <th>文字数</th>
                            <td><span id="finalCharacters">0</span> 文字</td>
                        </tr>
                        <tr>
                            <th>総ミスタイプ</th>
                            <td><span id="finalMiss">0</span> 回</td>
                        </tr>
                        <tr>
                            <th>正誤率</th>
                            <td><span id="finalAccuracy">100.0</span> %</td>
                        </tr>
                        <tr>
                            <th>打鍵速度</th>
                            <td><span id="finalTypingSpeed">0.00</span> 打/秒</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-actions">
                <button id="restartButton">もう一度遊ぶ</button>
            </div>
        </div>
    </div>

    <div id="settings-sidebar">
        <div class="modal-content">
            <h2>設定</h2>
            <div class="setting-item">
                <label for="typing-sound-toggle">タイピング音:</label>
                <input type="checkbox" id="typing-sound-toggle" checked>
            </div>
            <div class="setting-item">
                <label for="mistype-sound-toggle">ミスタイプ音:</label>
                <input type="checkbox" id="mistype-sound-toggle" checked>
            </div>
            <div class="setting-item">
                <label for="mistype-effect-toggle">ミスしたときの演出:</label>
                <input type="checkbox" id="mistype-effect-toggle" checked>
            </div>

            <hr style="margin: 20px 0; border-color: #eee;">

            <h2>ファイルインポート</h2>
            <div class="file-import-section">
                <label for="romajiFile" class="file-import-label">ローマ字ルール:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="romajiFile" accept=".txt" class="hidden-file-input">
                    <button type="button" class="small-button import-button" data-target="romajiFile">ファイルを選択</button>
                    <div class="file-name" id="romajiFileName">未選択（デフォルトを使用）</div>
                </div>
                <button id="resetRomajiButton" class="small-button">デフォルトに戻す</button>
            </div>

            <div class="file-import-section">
                <label for="wordsFile" class="file-import-label">問題ファイル:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="wordsFile" accept=".txt" class="hidden-file-input">
                    <button type="button" class="small-button import-button" data-target="wordsFile">ファイルを選択</button>
                    <div class="file-name" id="wordsFileName">未選択（デフォルトを使用）</div>
                </div>
                <button id="resetWordsButton" class="small-button">デフォルトに戻す</button>
            </div>
        </div>
    </div>

    <div id="explanation-section" class="game-container" style="margin-top: 50px;">
        <h2>タイピングゲームの説明</h2>
        <p>このタイピングゲームは、表示される漢字（またはひらがな）をローマ字で入力していくゲームです。</p>

        <h3>遊び方</h3>
        <ul>
            <li>ゲームが始まったら、画面中央に表示される<strong>漢字（お題）</strong>とその下の<strong>ひらがな</strong>を読み、<strong>ローマ字</strong>で入力してください。</li>
            <li>入力は、キーボードで行います。</li>
            <li>正しく入力すると次の文字に進み、間違えるとミスとなります。ミスタイプはカウントされますが、ゲームは続行されます。</li>
            <li>制限時間内にできるだけ多くの文字を正確に入力し、高スコアを目指しましょう。</li>
            <li>ゲームは通常60秒間続きます。</li>
            <li>ゲーム中に <kbd>Escape</kbd> キーを押すとゲームを中断し、結果画面を表示します。</li>
        </ul>

        <h3>設定 (⚙️ボタン)</h3>
        <p>右上の⚙️ボタンをクリックすると、設定サイドパネルが開きます。ここでは以下の項目を調整できます。</p>
        <ul>
            <li><strong>タイピング音:</strong> キーを押したときの音のオン/オフを切り替えます。</li>
            <li><strong>ミスタイプ音:</strong> 間違ったキーを押したときの音のオン/オフを切り替えます。</li>
            <li><strong>ミスしたときの演出:</strong> ミスタイプ時に画面が赤く点滅する演出のオン/オフを切り替えます。</li>
            <li><strong>ファイルインポート:</strong>
                <ul>
                    <li><strong>ローマ字ルール:</strong> Google IMEのローマ字テーブル形式（例: <code>n n</code>, <code>shi si</code>）のテキストファイルを読み込むことで、入力ルールをカスタマイズできます。AZIK互換のローマ字テーブルにも対応しています。独自の入力方式で練習したい場合などに便利です。</li>
                    <li><strong>問題ファイル:</strong> 漢字とひらがなのペア（例: <code>犬 いぬ</code>）が改行で区切られたテキストファイルを読み込むことで、出題される問題を自由に変更できます。特定の単語や文章を練習したい場合にご利用ください。</li>
                    <li>各ファイルのインポートボタンの下にある「デフォルトに戻す」ボタンで、いつでも初期設定に戻すことができます。</li>
                </ul>
            </li>
        </ul>

        <h3>スコアと統計</h3>
        <ul>
            <li><strong>打鍵数:</strong> 入力したキーの総数です。</li>
            <li><strong>文字数:</strong> 正しく入力した文字の総数です。</li>
            <li><strong>ミス:</strong> 間違って入力した回数です。</li>
            <li><strong>正誤率:</strong> (総打鍵数 - ミスタイプ数) / 総打鍵数 * 100 で計算されます。</li>
            <li><strong>打鍵速度:</strong> 1秒あたりの平均打鍵数です。</li>
        </ul>

        <h3>終了と再開</h3>
        <ul>
            <li>ゲーム終了後は結果が表示され、もう一度プレイするか選択できます。</li>
            <li>結果画面を閉じた後でも、「結果を表示」ボタンをクリックすればいつでも結果を確認できます。</li>
        </ul>
    </div>

    <script src="script.js"></script>
</body>
</html>
